cache:
  directories:
  - $TRAVIS_BUILD_DIR/Build/Cache
git:
  depth: false
jobs:
  include:
  - name: Linux
    os: linux
    env:
    - CACHE_NAME=Linux
    services:
    - docker
    script:
    - ./dockerbuildserver.sh
    - ./weld.sh node index.js all --alias=Linux
    deploy:
    - provider: releases
      skip_cleanup: true
      api_key: $GITHUB_TOKEN
      file_glob: true
      file: Build/Packages/*
      on:
        tags: true
        branch: master
  - name: Emscripten
    os: linux
    env:
    - CACHE_NAME=Emscripten
    services:
    - docker
    script:
    - ./dockerbuildserver.sh
    - ./weld.sh node index.js all --alias=Emscripten
    deploy:
    - provider: releases
      skip_cleanup: true
      api_key: $GITHUB_TOKEN
      file_glob: true
      file: Build/Packages/*
      on:
        tags: true
        branch: master
    - provider: pages
      skip_cleanup: true
      local_dir: Build/Page/
      github_token: $GITHUB_TOKEN
      keep_history: false
      on:
        tags: true
        branch: master
  - name: Windows
    os: windows
    env:
    - CACHE_NAME=Windows
    language: node_js
    node_js:
    - 13
    install:
    - npm install
    - choco install doxygen.install
    - choco install llvm --version=6.0.1 --allow-downgrade
    - choco install ninja
    - df -h
    - rm -rf "C:\ProgramData\docker\windowsfilter" &
      rm -rf "C:\ProgramData\Package Cache" &
      rm -rf "C:\ProgramData\chocolatey\lib\mingw" &
      rm -rf "C:\Program Files (x86)\Android" &
      rm -rf "C:\Windows\SoftwareDistribution\Download" &
      rm -rf "C:\Recovery" &
      rm -rf "C:\Program Files (x86)\Microsoft SDKs\UWPNuGetPackages"
    - df -h
    script:
    - node index.js all --alias=Windows
    deploy:
    - provider: releases
      skip_cleanup: true
      api_key: $GITHUB_TOKEN
      file_glob: true
      file: Build/Packages/*
      on:
        tags: true
        branch: master
